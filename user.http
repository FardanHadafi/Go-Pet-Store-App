### Base URL
@baseUrl = http://localhost:3000/api

### 1. REGISTER USER - Success
POST {{baseUrl}}/users/register
Accept: application/json
Content-Type: application/json

{
  "username": "testuser3",
  "password": "password123",
  "email": "test@example.com"
}

### 2. REGISTER USER - Duplicate username (should fail)
POST {{baseUrl}}/users/register
Accept: application/json
Content-Type: application/json

{
  "username": "testuser3",
  "email": "test@example.com",
  "password": "password123"
}

### 4. LOGIN WITH USERNAME - Success
POST {{baseUrl}}/users/login
Accept: application/json
Content-Type: application/json

{
  "username": "testuser3",
  "password": "password123"
}

### 5. LOGIN WITH EMAIL - Success (if supported)
POST {{baseUrl}}/users/login
Accept: application/json
Content-Type: application/json

{
  "username": "testuser3",
  "email": "test@example.com", // BUG can login with same email, validate duplicate email
  "password": "password123"
}

### 6. LOGIN USER - Wrong password (should fail)
POST {{baseUrl}}/users/login
Accept: application/json
Content-Type: application/json

{
  "username": "testuser3",
  "email": "test@example.com",
  "password": "wrongpassword"
}

### 7. LOGIN USER - Non-existent username (should fail)
POST {{baseUrl}}/users/login
Accept: application/json
Content-Type: application/json

{
  "username": "nonexistent",
  "email": "test@example.com",
  "password": "password123"
}

### 8. LOGIN USER - Non-existent email (should fail)
POST {{baseUrl}}/users/login
Accept: application/json
Content-Type: application/json

{
  "username": "testuser",
  "email": "nonexistent@example.com",
  "password": "password123"
}

### 9. FIND ALL USERS
GET {{baseUrl}}/users
Accept: application/json

### 10. FIND USER BY ID - Success
GET {{baseUrl}}/users/11
Accept: application/json

### 11. FIND USER BY ID - Non-existent user (should fail)
GET {{baseUrl}}/users/999
Accept: application/json

### 12. UPDATE USER - Success
PUT {{baseUrl}}/users/11
Accept: application/json
Content-Type: application/json

{
  "username": "testuser_updated2",
  "email": "updated2@example.com"
}

### 13. UPDATE USER - Verify update worked
GET {{baseUrl}}/users/11
Accept: application/json

### 14. CHANGE PASSWORD - Success (with OldPassword and NewPassword)
PATCH {{baseUrl}}/users/11/password
Accept: application/json
Content-Type: application/json

{
  "old_password": "password123",
  "new_password": "newpassword12345"
}

### 15. LOGIN WITH NEW PASSWORD - Verify password change (using username)
POST {{baseUrl}}/users/login
Accept: application/json
Content-Type: application/json

{
  "username": "testuser_updated2",
  "password": "newpassword12345"
}

### 16. CHANGE PASSWORD - Wrong old password (should fail)
PATCH {{baseUrl}}/users/11/password
Accept: application/json
Content-Type: application/json

{
  "old_password": "wrongoldpassword",
  "new_password": "anothernewpassword"
}

### 17. CHANGE PASSWORD - Non-existent user (should fail)
PATCH {{baseUrl}}/users/999/password
Accept: application/json
Content-Type: application/json

{
  "old_password": "somepassword",
  "new_password": "newpassword123"
}

### 18. DELETE USER - Success (delete second user)
DELETE {{baseUrl}}/users/11
Accept: application/json

### 19. VERIFY USER DELETED - Should fail
GET {{baseUrl}}/users/11
Accept: application/json

### 20. DELETE USER - Non-existent user (should fail)
DELETE {{baseUrl}}/users/999
Accept: application/json

### 21. FINAL STATE - Get all users
GET {{baseUrl}}/users
Accept: application/json